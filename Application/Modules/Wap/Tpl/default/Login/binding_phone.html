<script src="__PUBLIC__/wap/js/flexible.js"></script>
<script type="text/javascript" src="__PUBLIC__/wap/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.form.js"></script>
<script src="__PUBLIC__/bootstrap/vendor/jquery-validation/jquery.validate.wap.js"></script>
<script type="text/javascript" src="__PUBLIC__/layer/layer.js"></script>
<link href="__PUBLIC__/wap/css/icons.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/wap/css/base.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/wap/css/member.css" />
<div class="shares_binding_wx" style=" height:100%; background:#f1ffcd ;">
	<div class="new head">
		<a href="javascript:history.go(-1)" class="md-close back">
			<i class="iconfont">&#xe617</i>
		</a>
		<h2>完善资料</h2>
	</div>

	<div class="bggreen">
		<form id="binding_form"  role="form" class="mlogin newbox" action="" novalidate method="post" onSubmit="return false;">
            <div class="field">
                <div class="label"> 姓名 </div>
                <div class="field-control">
                    <input class="input-required" type="tel" name="real_name" id="real_name" placeholder="请输入用户姓名" value="{$data.real_name}" >
                </div>
            </div>
			<div class="field">
				<div class="label"> 手机号 </div>
				<div class="field-control">
					<input class="input-required" type="tel" name="binding_mobile" id="binding_mobile" placeholder="请输入手机号码" value="{$data.mobile}" maxlength="11">
				</div>
			</div>
            <div class="field">
                <div class="label"> 公司名称 </div>
                <div class="field-control">
                    <input class="input-required" type="tel" name="company" id="company" placeholder="请输入公司名称" value="{$data['company']}" >
                </div>
            </div>
			<input type="hidden" name="is_binding" id="is_binding" value="0">
			<div class="submit mgt4" style="position:static">
				<button type="button" href="javascript: void(0);" class="button phone_binding_btn">完善资料</button>
			</div>
		</form>
	</div>
</div>
<script>
    jQuery(document).ready(function() {

        //FormValidator.init();
        jQuery.validator.addMethod ("checkType",function(value){
            var re =/^[\u4e00-\u9fa5]*$/.test($("#real_name").val());
            var ret = false;
            if(re){
                ret = true;
            }
            return ret;
        });
        $("#binding_form").validate({
            rules: {
                binding_mobile: {
                    required:true,
                    number:true,
                    minlength:11,
                    remote: {
                        url: "{:U('Wap/Login/cheack_binding_mobile')}",
                        type: "get",
                        dataType: "json",
                        data: {
                            mobile: function () {
                                return $("#binding_mobile").val();　　　　//这个是取要验证的数据
                            }
                        },
                        dataFilter: function (msg) {　　　　//判断控制器返回的内容
                            $('#is_binding').val(msg);
                            //0  未注册 1 已注册
                            return true;
                        }
                    }
                },
                real_name:{
                    required:true,
                    checkType:true
                }
            },
            messages: {
                binding_mobile:{
                    binding_pwd_required:'<span class="icon-warning icon_warning"></span>&nbsp;请输入手机号码',
                    number:'<span class="icon-warning icon_warning"></span>&nbsp;请输入正确的手机号码',
                    minlength:'<span class="icon-warning icon_warning"></span>&nbsp;请输入正确的手机号码',
                    remote:'<span class="icon-warning icon_warning"></span>&nbsp;手机号码已注册'
                },
                real_name: {
                    required:'<span></span>&nbsp;请输入真实姓名',
                    checkType:'<span class="icon-warning icon_warning"></span>&nbsp;姓名只能输入中文'
                }
            },
            focusInvalid:false,
            success: function(label) {
                // set  as text for IE 
                // alert('ok'); 
                //label.html(" ").addClass("checked"); 
            },
            /*执行ajaxsubmit  */
            submitHandler: function(editform) {

                var options = {
                    url :  "<?php echo U('Wap/Login/binding'); ?>",
                    type : "post" ,
                    dataType:'json',
                    target : "#loader",
                    error: function(){layer.msg("服务器没有返回数据，可能服务器忙，请重试",{icon:5});},
                    onwait : "正在处理信息，请稍候...",
                    success: function(response){
                        // console.log(response);
                        //$("#loader").fadeIn(500).html(response.data).fadeOut(500); 
                        //$('#editform').hide(2000); 
                        if(response.status==1){
                            //alert("注册成功");
                            layer.msg('绑定成功', {icon: 6},function(){
                                //关闭后的操作
                                window.location.href="<?php echo U('Wap/Member/index'); ?>";
                            });
                        }else{
                            layer.msg(response.error, {icon: 5});
                            // alert(response.error);
                        }
                    }
                };
                setTimeout((function(opt){
                    return function(){
                        $('#binding_form').ajaxSubmit(opt);
                    }
                })(options), 300);
                return false;
            }

        });



        $('.phone_binding_btn').click(function(){
            $('#binding_form').submit();
        });

    });

</script>
<script type="text/javascript">
    $(function(){
        set_scroll()

    });
    $(window).scroll(function () {
        set_scroll()
    });
    function set_scroll(){
        if ($(window).scrollTop() > 5) {
            $(".is_guanzhu_all").css('cssText', 'position:fixed;top:0;z-index:999;');
            ;
        }
        else {
            $(".is_guanzhu_all").css('cssText', '');
            ;
        }
    }
</script>