<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>店主专区</title>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes">
	<script type="text/javascript" src="__PUBLIC__/wap/js/jquery.min.js"></script>
	<script src="__PUBLIC__/wap/js/flexible.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/jquery.form.js"></script>
	<script src="__PUBLIC__/bootstrap/vendor/jquery-validation/jquery.validate.wap.js"></script>
	<script type="text/javascript" src="__PUBLIC__/layer/layer.js"></script>
	<style>
		html, body, h2, h4, h6, li, div, dl, dt, dd, div { margin: 0; padding: 0; }
		html, body { background: #d92a58; height: 100%; }
		.clearfix:after { visibility: hidden; display: block; font-size: 0; content: " "; clear: both; height: 0; }
		.clearfix { *zoom:1;
		}
		* { box-sizing: border-box; margin: 0; padding: 0; }
		.entxt { font-family: Arial; }
		.topbanner { width: 100%; height: auto; display: block; }
		.progress { background-size: 100% auto; padding: .4rem .3rem .4rem .3rem; z-index: 4; width: 100%; }
		.progress .tag { position: relative; width: 9rem; margin: 0 auto; }
		.progress .tag1 { position: absolute; left: 27.6%; width: 1.4rem; hieght: auto; }
		.progress .tag2 { position: absolute; right: 0; width: 1.4rem; hieght: auto; }
		.progress .compute { text-align: center; margin-top: 1.8rem; width: 100%; }
		.progress .compute span { color: #fdbb16; font-size: .3rem; }
		.progress .compute .entxt { color: #fff!important; }
		.progress .compute .standard { color: #fff!important; font-size: .34rem!important; }
		.loading { width: 10rem; height: .5rem; background-size: contain; border-radius: .6rem; overflow: hidden; margin: 0 auto; position: relative; top: 1.6rem; }
		.loading span { color: #fff; font-size: .24rem; }
		.loading .regular { position: absolute; left: 30%; font-size: .32rem; width: 1.4rem; hieght: auto; z-index: 5; }
		.loading .senior { position: absolute; right: .44rem; font-size: .32rem; width: 1.4rem; hieght: auto; z-index: 5; }
		.percent { width: 10rem; height: .5rem;  background-size: contain; border-radius: .6rem; overflow: hidden; margin: 0 auto; position: absolute; z-index: 6; }
		.percent .regular { color: #000!important; z-index: 6; }
		.percent .senior { color: #000!important; z-index: 6; }
		.loading .hid { height: 0.5rem; overflow: hidden; position: absolute; z-index: 8; }
		.progressbar .progress_bottom { width: 100%; height: .4rem; position: absolute; top: 0; z-index: 0; }
		.progressbar .percent { height: .4rem; position: absolute; top: 0; z-index: 1; background-size: 100% auto; }
		.lay { padding: .30rem; z-index: 3; height: 100%; }
		.product { border-radius: .2rem; background: #fff; position: relative; margin-bottom: .3rem; overflow: hidden; }
		.lay .product .proimg { width: 3.1rem; height: 3.1rem; padding: .2rem 0 .2rem .2rem; overflow: hidden; text-align: center; }
		.lay .product .proimg img { width: auto; height: 100%; }
		.lay .product .des { position: absolute; margin-left: 3.3rem; box-sizing: border-box; top: 0; padding-top: .2rem; width: 4.1rem; font-size: .34rem; }
		.lay .product .des .lab { display: block; margin-bottom: .1rem; color: #ff8106; font-size: .34rem; }
		.lay .product .des .name { padding: 0 0 .1rem 0; height: .6rem; line-height: .6rem; overflow: hidden; color: #666; display: block; font-size: .34rem; }
		.lay .product .price { color: #ff8106; font-size: .4rem; padding-top: .2rem; }
		.lay .product .subtitle { font-size: .30rem; color: #999; display: block; overflow: hidden; line-height: .4rem; height: .8rem; }
		.lay .product .choose { height: 1rem; width: 1rem; border-radius: 1rem; position: absolute; top: .3rem; right: .3rem; }
		.lay .product .right { width: 1.9rem; position: absolute; top: 0; right: 0; }
		.lay .product .right img { width: 100%; height: auto; }
		.lay .product .right .purchase { background: rgba(93,0,56,0.8); height: 0.8rem; line-height: 0.7rem; width: 100%; position: absolute; bottom: 0rem; color: #fff; text-align: center; font-size: .36rem; }
		.submit { text-align: center; margin: 1rem 0 1rem 0; z-index: 6; }
		.submit a { color: #d92a58; font-size: .4rem; background: #ffd409; margin: 0 auto; border-radius: .1rem; padding: .3rem 0; display: block; text-decoration: none; }
	</style>
</head>
<body class="shopkeeper">
<img class="topbanner" src="__PUBLIC__/wap/img/upgrade/top.png"/>

<div class="progress" style="background: url(__PUBLIC__/wap/img/upgrade/middle.png) top center no-repeat;">
	<div class="tag">
		<img src="__PUBLIC__/wap/img/upgrade/tag1.png" class="tag1">
		<img src="__PUBLIC__/wap/img/upgrade/tag2.png" class="tag2">
	</div>
	<div class="loading" style="background: url(__PUBLIC__/wap/img/upgrade/progress_bottom.png); ">

		<div class="hid" style="width:0%">
			<div class="percent" style="background: url(__PUBLIC__/wap/img/upgrade/progress_top.png);">
				<span class="regular">标准店铺</span>
				<span class="senior">高级店铺</span>
			</div>
		</div>
		<span class="regular">标准店铺</span>
		<span class="senior">高级店铺</span>
	</div>
	<div class="compute">
		<div  class="fart1  fart" <eq name="data['member_vip_type']" value="0" >  <else/>	style="display:none"	</eq>>
			<span>亲 再选购<span class="entxt">599</span>元的商品就可以成为</span><span class="standard">标准店铺</span><span>哦</span>
		</div>
		<div class="fart2  fart" <eq name="data['member_vip_type']" value="1" >  <else/>	style="display:none"	</eq>>
			<span>亲 您已经成为标准店铺！再选购<span class="entxt">1000</span>元的商品就可成为</span><span class="standard">高级店铺</span><span>哦</span>
		</div>
	</div>
</div>
<div class="lay">
	<form id="form2"  role="form" action="" novalidate method="post" onSubmit="return false;">
	<volist name="list" id="vo">
		<a href="javascript:void (0)">
			<div class="product">
				<div class="proimg">
					<img src="{:thumbs_auto($vo['goods_img'], 200, 200)}"/>
				</div>
				<div class="des">
	  <span class="name gray6">
	  	{$vo.goods_name}
	  </span>
					<span class="lab">{$vo.feeling}</span>
					<span class="subtitle">{$vo.subtitle}</span>
					<div class="price">
						<span class="entxt">￥{$vo.shop_price}</span><span class="orange">元</span>
					</div>
				</div>
				<div class="right">
					<a href="javascript:void (0)" class="choose_this"  data_price="{$vo.shop_price}"  data_id="{$vo.goods_id}"  data_status="0">
						<img src="__PUBLIC__/wap/img/upgrade/right.png">
						<div class="purchase f40 white">立即选购</div>
					</a>
				</div>
				<input type="checkbox"  name="goods_ids[]"  class="check_{$vo.goods_id}"  value="{$vo.goods_id}" hidden />
			</div>
		</a>
	</volist>
	</form>
	<div class="clearfix">
	</div>
	<div class="submit"><a href="javascript:void (0)" id='submit'>提交</a></div>
</div>
<input type="hidden" value="{$is_binding}" id="is_binding">
<script type="text/javascript">
$(function(){
//获取要定位元素距离浏览器顶部的距离
var navH = $(".progress").offset().top;

//滚动条事件
$(window).scroll(function(){
//获取滚动条的滑动距离
var scroH = $(this).scrollTop();
//滚动条的滑动距离大于等于定位元素距离浏览器顶部的距离，就固定，反之就不固定
if(scroH>=navH){

$(".progress").css({"position":"fixed","top":0});
}else if(scroH<navH){
$(".progress").css({"position":"static"});
}
});
	var vip_type = {$data.member_vip_type};
	var total_price = 0;
	$('.choose_this').click(function () {
		var _this = $(this);
		var choose_status = _this.attr('data_status');
		var price = parseFloat(_this.attr('data_price'));
		var goods_id = _this.attr('data_id');
		if(choose_status == 1 ){
			$('.check_'+goods_id).attr("checked", false);
			_this.find('.purchase').html('立即选购');
			_this.attr('data_status','0');
			total_price = parseFloat(total_price) - price;
			var c_type = 0;
		}else {
			$('.check_'+goods_id).attr("checked", true);
			_this.find('.purchase').html('已选择');
			_this.attr('data_status','1');
			total_price = parseFloat(total_price) + price;
			var c_type = 1;
		}
		var c_price = price/1599 * 100;
		change_percent(c_price , c_type );
		change_status(total_price,vip_type);
	});

	//改变进度条
	var progressbar_width = $('.loading').css('width');
	var percent_width = $('.percent').css('width');
	if(vip_type == 1){
		change_percent(37.46,1);

	}else if(vip_type >= 2){
		change_percent(100,1);
	}
	var a = parseInt($('.hid').css('width'))*100/parseFloat($('.loading').css('width'))+"%";
		//function改变进度条
	function change_percent(percent,type){
		var current_percent = parseFloat($('.hid').css('width'))*100/parseFloat($('.loading').css('width'));
		if(type == 1){
			var new_percent = current_percent +percent;
		}else {
			var new_percent = current_percent - percent;
		}
		$('.hid').animate({'width':new_percent+'%'});
	}
		//function改变状态
	function change_status(price,level){
		var content = '';
		if(level == 0){
			if(price < 599){
				content = '<span>亲 再选购<span class="entxt">'+ (599 - price)+'</span>元的商品就可以成为</span><span class="standard">标准店铺</span><span>哦</span>';
			}else {
				content = '<span>亲 再选购<span class="entxt">'+ (1599 - price)+'</span>元的商品就可以成为</span><span class="standard">高级店铺</span><span>哦</span>';
			}
		}else if(level == 1){
			if(price < 1000) {
				content = '<span>亲 再选购<span class="entxt">' + (1000 - price) + '</span>元的商品就可以成为</span><span class="standard">高级店铺</span><span>哦</span>';
			}
		}
		$('.fart').html(content);
	}
	var is_binding = $('#is_binding').val();
	//定义一个产生订单请求的变量
	$("#submit").click(function () {
		if(is_binding == 0 || is_binding == null){
			window.location.href = "<?php echo U('wap/upgrade/member_info_full',array('share'=>$share_para)); ?>";
		}else {
			setTimeout(function () {
				$.ajax({
					url: "<?php echo U('wap/upgrade/set_order'); ?>",
					type: "post",
					data: $('#form2').serialize(),
					dataType: 'json',
					target: "#loader",
					error: function () {
						layer.msg("服务器没有返回数据，可能服务器忙，请重试", {icon: 5});
					},
					onwait: "正在处理信息，请稍候...",
					success: function (response) {
						/*console.log(response);
						 return false;*/
						if (response.status == 1) {
							window.location.href = "<?php echo U('wap/upgrade/upgrade_pay'); ?>?order_id=" + response.order_id;
						} else if (response.status == 2) {
							window.location.href = "<?php echo U('wap/upgrade/member_info_full',array('share'=>$share_para)); ?>";
						} else {
							//alert(response.error);
							if (response.error) {
								layer.msg(response.error, {icon: 5});
							} else {
								layer.msg('该订单已提交', {icon: 5});
							}
						}
					}
				});
			}, 300);
		}
	});
});


</script>

</body>
</html>
